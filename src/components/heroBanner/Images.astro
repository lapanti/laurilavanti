---
/* eslint-disable astro/no-unused-css-selector */
import type { Image as ContentfulImage } from '../../types/contentful'

import { Image, Source } from '@unpic/astro' /* eslint-disable-line import/no-unresolved */

import { sizes } from '../../lib/styles'
import BackgroundImage from './images/BackgroundImage.astro'

interface Props {
    backgroundImage?: ContentfulImage
    image?: ContentfulImage
}

const { backgroundImage, image } = Astro.props

const sharedProps = {
    height: 562,
    operations: { contentful: { f: 'face' as const, q: 80 } },
    src: `https:${image?.fields?.file?.url}`,
    width: 560,
}
---

<style define:vars={{ sizes1Negative: `-${sizes[1]}`, sizes2: sizes[2], sizes5Negative: `-${sizes[5]}` }}>
    .container {
        display: flex;
        flex: 1;
        overflow: hidden;
        position: relative;
        margin-top: var(--sizes2);
    }

    .image {
        margin-left: var(--sizes1Negative);
    }

    @media (min-width: 1200px) {
        .container {
            overflow: visible;
            width: 50%;
            margin-top: 0;
        }

        .image {
            bottom: 0;
            position: absolute;
            right: var(--sizes5Negative);
            margin-top: auto;
        }
    }
</style>
<div class="container">
    <BackgroundImage image={backgroundImage} />
    {
        image?.fields?.file?.url && (
            <picture>
                <Source {...sharedProps} type="image/avif" />
                <Source {...sharedProps} type="image/webp" />
                <Image
                    {...sharedProps}
                    alt={image.fields.description ?? null}
                    background="transparent"
                    class="image"
                    layout="constrained"
                    priority
                />
            </picture>
        )
    }
</div>
