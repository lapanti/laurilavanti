---
import type { Image as ContentfulImage } from '../../types/contentful'

import { Image, Source } from '@unpic/astro' /* eslint-disable-line import/no-unresolved */

import { sizes, typographics } from '../../lib/styles'

interface Props {
    caption: string
    image: ContentfulImage
}

const { image, caption } = Astro.props

const sharedProps = {
    height: 500,
    operations: { contentful: { f: 'face' as const, q: 80 } },
    src: `https:${image?.fields?.file?.url}`,
    width: 1200,
}
---

<style
    define:vars={{
        additionalInfoFontFamily: typographics.additionalInfo.fontFamily,
        additionalInfoFontSize: typographics.additionalInfo.fontSize,
        additionalInfoFontWeight: typographics.additionalInfo.fontWeight,
        additionalInfoLineHeight: typographics.additionalInfo.lineHeight,
        sizes05: sizes[0.5],
        sizes1: sizes[1],
    }}
>
    figure {
        grid-column-start: 3;
        margin-bottom: var(--sizes1);
        margin-top: var(--sizes1);
    }

    figcaption {
        font-family: var(--additionalInfoFontFamily);
        font-weight: var(--additionalInfoFontWeight);
        font-size: var(--additionalInfoFontSize);
        line-height: var(--additionalInfoLineHeight);
        display: flex;
        flex-direction: row;
        justify-content: center;
        margin-top: var(--sizes05);
        width: 100%;
    }
</style>
{
    image?.fields?.file?.url && (
        <figure aria-label={caption}>
            <picture>
                <Source {...sharedProps} type="image/avif" />
                <Source {...sharedProps} type="image/webp" />
                <Image {...sharedProps} alt={image.fields.description ?? null} layout="constrained" />
            </picture>
            <figcaption>{caption}</figcaption>
        </figure>
    )
}
