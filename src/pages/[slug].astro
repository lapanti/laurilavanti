---
import type { TagCollection } from 'contentful'
import type { Page } from '../types/contentful'

import Layout from '../layouts/Layout.astro'
import { contentfulClient } from '../lib/contentful'

export async function getStaticPaths() {
    const entries = await contentfulClient.getEntries<Page>({
        content_type: 'page',
        include: 10,
    })

    const tags = await contentfulClient.getTags()

    const pages = entries.items.map((item) => ({
        params: { slug: item.fields.slug },
        props: {
            body: item.fields.body,
            description: item.fields.description,
            image: item.fields.image,
            jsonLdType: item.fields.jsonLdType,
            slug: item.fields.slug,
            tags,
            title: item.fields.title,
        },
    }))

    return pages
}

interface Props {
    body: Page['fields']['body']
    description: Page['fields']['description']
    image: Page['fields']['image']
    jsonLdType: Page['fields']['jsonLdType']
    slug: Page['fields']['slug']
    tags: TagCollection
    title: Page['fields']['title']
}

const { description, title, image, body, slug, jsonLdType, tags } = Astro.props
---

<Layout
    allTags={tags}
    body={body}
    description={description}
    heroImage={image}
    slug={slug}
    title={title}
    type={jsonLdType}
/>
