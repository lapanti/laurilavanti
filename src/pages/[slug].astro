---
import Layout from '../layouts/Layout.astro'
import { contentfulClient } from "../lib/contentful";
import type { Page } from '../types/contentful';
import type { TagCollection } from 'contentful';

export async function getStaticPaths() {
  const entries = await contentfulClient.getEntries<Page>({
    content_type: "page",
    include: 10,
  });

  const tags = await contentfulClient.getTags()

  const pages = entries.items.map((item) => ({
    params: { slug: item.fields.slug },
    props: {
      description: item.fields.description,
      title: item.fields.title,
      image: item.fields.image,
      body: item.fields.body,
      slug: item.fields.slug,
      jsonLdType: item.fields.jsonLdType,
      tags,
    },
  }));

  return pages;
}

interface Props {
  description: Page['fields']['description']
  title: Page['fields']['title']
  slug: Page['fields']['slug']
  body: Page['fields']['body']
  image: Page['fields']['image']
  jsonLdType: Page['fields']['jsonLdType']
  tags: TagCollection
}

const { description, title, image, body, slug, jsonLdType, tags } = Astro.props
---

<Layout description={description} title={title} heroImage={image} body={body} slug={slug} type={jsonLdType} allTags={tags} />
